<h2 mat-dialog-title>Administrer les courriers confidentiels</h2>
<mat-dialog-content>
    <form #redirectConfForm="ngForm">
        <div class="modal-body">
            <div class="alert alert-warning" role="alert" *ngIf="data.hasConfidentialityInstances">
                <p>Cet utilisateur à des
                    <b>courriers confidentiels</b> associés à ce service.</p>
                <p>Il est préférable de les affecter à un autre utilisateur du service.</p>
            </div>
            <div class="alert alert-warning" role="alert" *ngIf="data.hasListTemplates">
                <p>Cet utilisateur est présent dans le modèle de diffusion de l'entité.</p>
            </div>
            <div class="input-group">
                    <mat-radio-group id="processMode" name="processMode" style="display: inline-flex;flex-direction: column;" [(ngModel)]="this.processMode" color="primary">
                            <mat-radio-button value="" checked="true" color="primary">
                                Ne rien faire (Dissocier l'entité)
                            </mat-radio-button>
                            <mat-radio-button value="delete" color="primary">
                                Supprimer la personne (liste de diffusion + modèle de l'entité)
                            </mat-radio-button>  
                            <mat-radio-button value="reaffect" color="primary">
                                Réaffecter à l'utilisateur (liste de diffusion + modèle de l'entité) :
                            </mat-radio-button>
                        </mat-radio-group>
                        <mat-form-field *ngIf="this.processMode == 'reaffect'">
                            <input name="userDestRedirectModel" id="userDestRedirectModel" type="text" placeholder="Utilisateur de remplacement" matInput
                                [matAutocomplete]="auto" [formControl]="userCtrl" [(ngModel)]="this.redirectUser" tabindex="-1" required>
                            <mat-autocomplete #auto="matAutocomplete">
                                <mat-option value="NO_USER" style="text-align:center;">
                                    <i>- aucun utilisateur de remplacement -</i>
                                </mat-option>
                                <ng-container *ngFor="let user of filteredUsers | async">
                                    <mat-option [value]="user.id">
                                        <div class="container-fluid">
                                            <span class="col-xm-1">
                                                <mat-icon color="primary" class="fa fa-user fa-2x" style="margin-right:0px;"></mat-icon>
                                            </span>
                                            <span class="col-xm-11">
                                                {{ user.idToDisplay }}
                                                <small>{{ user.otherInfo }}</small>
                                            </span>
                                        </div>
                                    </mat-option>
                                </ng-container>
                            </mat-autocomplete>
                        </mat-form-field>
            </div>
            
        </div>
        <mat-dialog-actions>
            <button mat-raised-button color="primary" type="submit" [disabled]="!this.redirectUser && this.processMode == 'reaffect'" (click)="dialogRef.close({newUser:this.redirectUser,processMode:this.processMode})">{{lang.validate}}</button>
        </mat-dialog-actions>
    </form>
</mat-dialog-content>